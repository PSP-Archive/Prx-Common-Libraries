#include <pspimpose_driver.h>
#include "cmlibaudio.h"

PSP_MODULE_INFO("cmlibAudio", PSP_MODULE_KERNEL, 1, 0);


int ioflag = 0;
int muteflag = 0;


////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioGetVolume
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libaudioGetVolume(void)
{
  return sceImposeGetParam(PSP_IMPOSE_MAIN_VOLUME);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioSetVolume
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libaudioSetVolume(int value)
{
  int buf = value;
  if(buf > 30)buf = 30;
  if(buf < 0)buf = 0;
  return sceImposeSetParam(PSP_IMPOSE_MAIN_VOLUME, buf);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioMuteSet
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

bool libaudioMuteSet()
{
	if(ioflag < 0)muteflag = 0;
	sceImposeSetParam(PSP_IMPOSE_MUTE, (muteflag > 0 ? 1 : 0) );
	return (muteflag >0 ? true : false);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioMuteOn
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libaudioMuteOn(bool *status)
{
	if(*status != true){
		*status = true;
		muteflag ++;
		libaudioMuteSet();
		return 0;
	}
	return -1;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioMuteOff
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libaudioMuteOff(bool *status)
{
	if(*status == true){
		*status = false;
		muteflag --;
		libaudioMuteSet();
		return 0;
	}
	return -1;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioMuteGetStatus
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libaudioMuteGetStatus(void)
{
  return sceImposeGetParam(PSP_IMPOSE_MUTE);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioMuteSetAgain
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

bool libaudioMuteSetAgain(void)
{
  return libaudioMuteSet();
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioIoSet
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int sceSysregAudioIoEnable(int no);
int sceSysregAudioIoDisable(int no);

bool libaudioIoSet()
{
	if(ioflag < 0)ioflag = 0;
	int k1 = pspSdkSetK1(0);
	(ioflag > 0 ? sceSysregAudioIoDisable(0) : sceSysregAudioIoEnable(0));
	pspSdkSetK1(k1);
	return (ioflag >0 ? true : false);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioIoEnable
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libaudioIoEnable(bool *status)
{
	if(*status == true){
		*status = false;
		ioflag --;
		libaudioIoSet();
		return 0;
	}
	return -1;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioIoDisable
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libaudioIoDisable(bool *status)
{
	if(*status != true){
		*status = true;
		ioflag ++;
		libaudioIoSet();
		return 0;
	}
	return -1;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioIoGetStatus
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

bool libaudioIoGetStatus()
{
	return (ioflag >0 ? true : false);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libaudioIoSetAgain
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

bool libaudioIoSetAgain()
{
	return libaudioIoSet();
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  ENTRY POINT
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int module_start(SceSize args, void *argp)
{
	return 0;
}

int module_stop(SceSize args, void *argp)
{
	return 0;
}
